<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Security Maturity Self‑Assessment &amp; ROI Calculator | ABI Consulting, LLC</title>
<meta content="Quick, free SMB security maturity self‑assessment and cybersecurity ROI calculator. Get your score and a tailored action plan — emailed instantly." name="description"/>
<style>
    :root {
  --nav:#0B1E39;
  --bg:#0B1E39;
  --text:#F5F7FB;
  --muted:#A3B3CC;
  --accent:#2E8CFF;
  --accent-2:#74B2FF;
  --border:rgba(255,255,255,.08);
  --card:#0B1E39;
  --panel:#0B1E39;
  --radius:18px;
  --shadow:0 10px 30px rgba(0,0,0,.35);
}
    html, body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji','Segoe UI Emoji'; }

    /* ======= Site Header (matches screenshot) ======= */
    .site-header {
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
}
    .site-header .bar { max-width: 1240px; margin: 0 auto; padding: 14px 18px; display:flex; align-items:center; justify-content:space-between; }
    .brand { display:flex; align-items:center; gap:10px; color:#fff; font-weight:700; letter-spacing:.2px; }
    .brand img { height:22px; width:auto; display:block; }
    .brand .name { font-size:15px; opacity:.95; }
    .nav ul { list-style:none; display:flex; gap:28px; padding:0; margin:0; }
    .nav a { color:#dbe7f5; text-decoration:none; font-size:15px; }
    .nav a:hover { text-decoration:underline; }

    /* ======= Page Layout ======= */
    .wrap { max-width: 1080px; margin: 0 auto; padding: 28px 16px 80px; }
    h1 { font-size: clamp(1.6rem, 2.6vw, 2.2rem); margin: 18px 0 6px; }
    p.lead { color: var(--muted); margin:0; }

    .grid { display:grid; grid-template-columns: 1fr; gap: 18px; }
    @media (min-width: 980px){ .grid { grid-template-columns: 1fr 1fr; } }

    .card {
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
}
    .card h2 { margin-top:4px; margin-bottom:8px; font-size: clamp(1.1rem, 2vw, 1.4rem); }
    .card p.desc { color: var(--muted); margin-top:0; }

    fieldset {
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding: 22px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(6px);
}
    legend { padding: 0 6px; font-size:.95rem; }
    .q-legend { font-weight:700; color: var(--accent); } /* Question N styling */
    .q { margin: 8px 0 6px; font-weight: 600; }
    .options { display:flex; flex-wrap:wrap; gap:10px; margin: 6px 0 0; }
    .pill { display:inline-flex; align-items:center; gap:8px; padding:8px 12px; #0b1020 border:1px solid var(--border); border-radius:999px; cursor:pointer; }
    .pill input { accent-color: var(--accent); }

    label.inline { display:block; margin:10px 0 6px; color: var(--muted); }
    input[type="text"], input[type="number"], input[type="email"], select { width:100%; #0b1020 color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; outline:none; }

    input[type="range"] { width:100%; }
    .range-row { display:flex; align-items:center; justify-content:space-between; gap:12px; color: var(--muted); }

    .muted { color: var(--muted); }
    .hint { font-size:.85rem; color: var(--muted); margin-top:4px; }

    .cta { display:flex; flex-wrap:wrap; gap:12px; align-items:center; justify-content:flex-start; margin-top:14px; }
    button.primary { background: linear-gradient(90deg, var(--accent), #3b82f6); color:#001018; border:none; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; }
    button.secondary { background:transparent; border:1px solid var(--border); border-radius:12px; padding:12px 16px; color:var(--text); cursor:pointer; }
    button:disabled { opacity:.6; cursor:not-allowed; }

    .result { border:1px dashed var(--border); border-radius:12px; padding:14px; margin-top:12px; display:none; }
    .badge { display:inline-block; padding:4px 10px; border-radius:999px; background:#081420; border:1px solid var(--border); font-size:.85rem;}
    .success { color: var(--accent-2); }
    .warn { color: var(--warn); }
    .danger { color: var(--danger); }

    footer { margin-top: 40px; border-top:1px solid var(--border); padding-top:18px; color:var(--muted); font-size:.9rem; }
    .small { font-size:.85rem; }
    .flex { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }

    .note { background:#0b1627; border-left:4px solid var(--accent); padding:12px 14px; border-radius:8px; color:var(--muted); }
  
/* === Inline help tooltips for each question === */
.help-wrap{ display:inline-flex; align-items:center; gap:8px; }
.help-btn{
  display:inline-flex; align-items:center; justify-content:center;
  width:20px; height:20px; border-radius:999px; border:1px solid var(--border);
  background:rgba(255,255,255,.06); color:var(--text); font-size:12px; line-height:1;
  cursor:pointer;
}
.help-btn:hover, .help-btn:focus{ outline:none; border-color:var(--accent); box-shadow:0 0 0 3px rgba(6,182,212,.25); }
.tip{ position:relative; display:inline-block; }
.tip-panel{position:absolute;z-index:1000;min-width:240px;max-width:360px;background:#0b1f33;color:#fff;border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:10px 12px;box-shadow:0 8px 22px rgba(0,0,0,.45);top:28px;left:0;display:none;opacity:1;}
.tip-panel.visible{ display:block; }
.tip-panel .title{ font-weight:700; color:#74B2FF; margin-bottom:4px; font-size:.95rem; }
.tip-panel .body{ color:#E6EDF6; font-size:.92rem; }
@media (max-width: 520px){
  .tip-panel{position:absolute;z-index:1000;min-width:240px;max-width:360px;background:#0b1f33;color:#fff;border:1px solid rgba(255,255,255,.18);border-radius:10px;padding:10px 12px;box-shadow:0 8px 22px rgba(0,0,0,.45);top:28px;left:0;display:none;opacity:1;}
}

.tooltip {
  position: absolute;
  background: #0b1f33;   /* solid dark navy */
  color: #fff;
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 0.85rem;
  line-height: 1.4;
  max-width: 260px;
  box-shadow: 0 6px 16px rgba(0,0,0,.35);
  z-index: 1000;
}


.tooltip {
  position: absolute;
  background: #0b1f33 !important;  /* solid navy */
  color: #fff !important;
  padding: 10px 12px;
  border-radius: 8px;
  font-size: 0.85rem;
  line-height: 1.4;
  max-width: 260px;
  box-shadow: 0 6px 16px rgba(0,0,0,.35);
  z-index: 1000;
  backdrop-filter: none !important;
  opacity: 1 !important;
}

</style>
</head>
<body>
<!-- ===== Header from your site ===== -->
<div class="site-header">
<div class="bar">
<div class="brand">
<img alt="Consulting logo" src="/assets/ABI_logo_transparent.png"/>
<span class="name">Consulting, LLC</span>
</div>
<nav aria-label="Primary" class="nav">
<ul>
<li><a href="/index.html">Home</a></li>
<li><a href="/services.html">Services</a></li>
<li><a href="/cyber_hygiene.html">Cyber Hygiene</a></li>
<li><a href="/about.html">About</a></li>
<li><a href="/resources.html">Resources</a></li>
<li><a href="/trusted_partners.html">Trusted Partners</a></li>
<li><a href="/blog.html">Blog</a></li>
<li><a href="/contact.html">Contact</a></li>
</ul>
</nav>
</div>
</div>
<div class="wrap">
<header style="display:flex; align-items:center; justify-content:space-between; gap:16px; padding: 14px 0 20px; border-bottom:1px solid var(--border); margin-bottom:18px;">
<div>
<h1>Security Maturity Self‑Assessment &amp; ROI Calculator</h1>
<p class="lead">Free, 5‑minute checkup for SMBs. Get a tailored action plan — and we’ll email your results.</p>
</div>
</header>
<div class="note small" style="margin-bottom:14px;">
<strong>Privacy:</strong> We use your email only to send your assessment. No spam. We’ll never sell your data.
    </div>
<div class="grid">
<!-- Maturity Quiz -->
<section class="card" id="quiz-card">
<h2>Security Maturity Self‑Assessment</h2>
<p class="desc">Answer the 10 questions below. Choose the option that best describes your current practice.</p>
<form id="maturity-form">
<div id="questions"></div>
<fieldset>
<legend>Your Business Contact</legend>
<label class="inline" for="company">Company Name</label>
<input id="company" name="company" placeholder="Acme, Inc." required="" type="text"/>
<label class="inline" for="name">Your Name</label>
<input id="name" name="name" placeholder="Jane Doe" required="" type="text"/>
<label class="inline" for="email">Business Email</label>
<input id="email" name="email" placeholder="jane@acme.com" required="" type="email"/>
<div class="hint">Personal domains (gmail, yahoo, outlook, icloud, etc.) are not accepted.</div>
<!-- Honeypot to deter bots -->
<label class="inline" for="website" style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;">Website</label>
<input autocomplete="off" id="website" name="website" style="position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden;" tabindex="-1" type="text"/>
</fieldset>
<div class="cta">
<button class="primary" id="calc-quiz" type="button">Calculate Maturity &amp; Email Me</button>
<button class="secondary" id="reset-quiz" type="button">Reset</button>
</div>
<div class="result" id="quiz-result"></div>
</form>
</section>
<!-- ROI Calculator -->
<section class="card" id="roi-card">
<h2>Cybersecurity ROI Calculator</h2>
<p class="desc">Estimate the potential financial impact of an incident vs. investing in baseline controls.</p>
<form id="roi-form">
<label class="inline" for="revenue">Annual Revenue (USD)</label>
<input id="revenue" min="0" placeholder="5000000" required="" step="1000" type="number"/>
<label class="inline" for="employees">Number of Employees</label>
<input id="employees" min="1" placeholder="75" required="" step="1" type="number"/>
<label class="inline" for="industry">Industry / Data Sensitivity</label>
<select id="industry" required="">
<option value="">Select…</option>
<option value="retail">Retail / Low Sensitivity</option>
<option value="professional">Professional Services / Moderate</option>
<option value="saas">SaaS / Mixed</option>
<option value="finance">Finance / High</option>
<option value="health">Healthcare / High</option>
<option value="defense">Defense / GovCon (CUI/ITAR/DFARS)</option>
</select>
<label class="inline" for="downtime">Estimated Downtime (days) if breached</label>
<input id="downtime" min="0" placeholder="3" required="" step="0.5" type="number"/>
<label class="inline" for="currentSpend">Current Security Spend (% of revenue)</label>
<input id="currentSpend" max="20" min="0" placeholder="1.0" required="" step="0.1" type="number"/>
<fieldset>
<legend>Baseline Controls (recommended)</legend>
<div class="flex">
<label class="pill"><input checked="" class="ctrl" type="checkbox" value="mfa"/> MFA</label>
<label class="pill"><input checked="" class="ctrl" type="checkbox" value="edr"/> Endpoint Detection</label>
<label class="pill"><input checked="" class="ctrl" type="checkbox" value="training"/> Security Awareness</label>
<label class="pill"><input class="ctrl" type="checkbox" value="ir"/> Incident Response Plan</label>
<label class="pill"><input class="ctrl" type="checkbox" value="vendor"/> Vendor Risk</label>
</div>
</fieldset>
<fieldset>
<legend>Risk Reduction Assumption</legend>
<div class="range-row">
<label class="inline" for="reduction" style="margin:0;">Assumed impact reduction from controls</label>
<span id="reductionLabel">35%</span>
</div>
<input id="reduction" max="60" min="10" step="1" type="range" value="35"/>
<div class="hint">Move the slider to see how changing control effectiveness (e.g., 20–60%) affects ROI.</div>
</fieldset>
<div class="cta">
<button class="primary" id="calc-roi" type="button">Calculate ROI</button>
<button class="secondary" id="reset-roi" type="button">Reset</button>
</div>
<div class="result" id="roi-result"></div>
</form>
</section>
</div>
<section class="card" style="margin-top:18px;">
<h2>What your result means</h2>
<p class="desc">We map your score to a maturity tier and recommend next steps. When you’re ready, we can help you move up a tier with a pragmatic, budget‑aware plan.</p>
<ul>
<li><span class="badge">Basic / Reactive</span> — Ad hoc practices; immediate wins: MFA, backups, patch cadence, password manager.</li>
<li><span class="badge">Developing</span> — Policies exist; formalize processes, add monitoring, train staff, vendor risk basics.</li>
<li><span class="badge">Advanced</span> — Strong controls; close gaps with tabletop IR, config baselines, KPI dashboards.</li>
<li><span class="badge">Optimized</span> — Continuous improvement; automation, metrics to leadership, third‑party assurances.</li>
</ul>
<div class="note" style="margin-top:10px;">
<strong>Call to Action:</strong> Ready for a formal roadmap or help implementing controls? Email <a href="mailto:damian@abiconsulting.llc">damian@abiconsulting.llc</a> or book a 30‑min consult. We’ll confirm next steps within two business days.
      </div>
</section>
<footer>
<div>© <span id="year"></span> ABI Consulting, LLC. All rights reserved.</div>
<div class="small">This tool is illustrative and not financial advice. For a tailored assessment, contact us.</div>
</footer>
</div>
<!-- EmailJS SDK (client-side email) -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
    // ===== Utility =====
    const YEAR = new Date().getFullYear();
    document.getElementById('year').textContent = YEAR;

    // Common personal/free email domains blacklist (expand as needed)
    const FREE_DOMAINS = new Set([
      'gmail.com','yahoo.com','outlook.com','hotmail.com','live.com','msn.com','icloud.com','me.com','aol.com','proton.me','protonmail.com','gmx.com','gmx.de','mail.com','yandex.com','pm.me','zoho.com','hey.com','fastmail.com','duck.com'
    ]);

    function isBusinessEmail(email){
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i;
      if(!re.test(email)) return false;
      const domain = email.split('@')[1].toLowerCase();
      if(FREE_DOMAINS.has(domain)) return false;
      for (const d of FREE_DOMAINS){ if(domain.endsWith('.'+d)) return false; }
      return true;
    }

    // ====== Maturity Quiz ======
    
const QUESTIONS = [
  { t:'Policies & Documentation', 
    h:'Written policies and procedures that state who does what and how. Reviewed at least annually so people know the current way of working.',
    o:['None / ad hoc','Basic for some areas','Mostly documented, not updated','Fully documented & reviewed'] },
  { t:'Risk Management / Threat Modeling', 
    h:'A repeatable way to list your important assets, likely threats, and business impact so you can prioritize fixes.',
    o:['Rarely','Only when required','At least yearly','Continuous & integrated'] },
  { t:'Identity & Access (MFA/Least Privilege)', 
    h:'Strong login and access practices: MFA for all, no shared accounts, and only the access people need to do their job.',
    o:['No MFA; shared accounts','External MFA; weak internal','Good MFA; some reviews','Strong IAM; periodic reviews'] },
  { t:'Endpoint / Network Protection', 
    h:'Keeping laptops/servers up‑to‑date, protected by EDR/AV, and the network segmented so one breach doesn’t spread.',
    o:['Minimal; reactive patching','Basic; patch delays','Good + some segmentation','Proactive + monitoring'] },
  { t:'Incident Response & Monitoring', 
    h:'A written incident plan, someone on point, monitoring in place, and practice drills so people know who does what.',
    o:['No plan/monitoring','Plan exists; rarely tested','Plan tested; some monitoring','Tested IR; lessons learned'] },
  { t:'Vendor / Third‑Party Risk', 
    h:'Checking security of the vendors who hold your data or connect to you (e.g., contracts, questionnaires, and remediation).',
    o:['No oversight','Ad hoc due diligence','Standard assessments','Ongoing oversight & SLAs'] },
  { t:'Training / Culture', 
    h:'Regular awareness training and phishing tests so people know how to spot and report issues.',
    o:['None/minimal','Basic occasionally','Regular; measured','Integrated; phishing tests'] },
  { t:'Patch & Config Hygiene', 
    h:'A schedule to patch software and standard “secure by default” settings so new systems aren’t left open.',
    o:['Rare/reactive','Some regular; misconfigs','Most patched; baselines','Automated; continuous audit'] },
  { t:'Backup & Business Continuity', 
    h:'Reliable, tested backups and a plan for keeping the business running if systems are down.',
    o:['No/Informal backups','Backups; weak BCP','Tested backups; BCP exists','Tested BCP/DR; BIA done'] },
  { t:'Regulatory / Compliance', 
    h:'Meeting required frameworks or regulations (e.g., NIST CSF/800‑171, HIPAA, PCI, ITAR/DFARS) with evidence.',
    o:['Ad hoc','Some controls','Most controls; some gaps','Compliant/on track; audits'] },
];


    function renderQuestions(){
      const container = document.getElementById('questions');
      container.innerHTML = '';
      QUESTIONS.forEach((q, idx) => {
        const fs = document.createElement('fieldset');
        const legend = document.createElement('legend');
        legend.textContent = `Question ${idx+1}`;
        legend.className = 'q-legend';
        fs.appendChild(legend);

        const head = document.createElement('div'); head.className = 'help-wrap';
        const qt = document.createElement('div'); qt.className = 'q'; qt.textContent = q.t;
        const help = document.createElement('button'); help.type='button'; help.className='help-btn tip'; help.setAttribute('aria-label', 'Help');
        help.textContent = '?';
        const panel = document.createElement('div'); panel.className='tip-panel'; panel.innerHTML = `<div class="title">${q.t}</div><div class="body">${q.h}</div>`;
        help.appendChild(panel);
        head.appendChild(qt); head.appendChild(help);
        fs.appendChild(head);

        const opts = document.createElement('div'); opts.className = 'options';
        q.o.forEach((opt, j) => {
          const id = `q${idx}_${j}`;
          const label = document.createElement('label'); label.className = 'pill';
          const input = document.createElement('input'); input.type = 'radio'; input.name = `q${idx}`; input.value = (j+1); input.id = id; input.required = true;
          const span = document.createElement('span'); span.textContent = opt;
          label.appendChild(input); label.appendChild(span); opts.appendChild(label);
        });
        fs.appendChild(opts); container.appendChild(fs);
      });

      // Tooltip behavior
      document.querySelectorAll('.help-btn').forEach(btn => {
        const panel = btn.querySelector('.tip-panel');
        const show = () => panel.classList.add('visible');
        const hide = () => panel.classList.remove('visible');
        btn.addEventListener('mouseenter', show);
        btn.addEventListener('mouseleave', hide);
        btn.addEventListener('focus', show);
        btn.addEventListener('blur', hide);
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          panel.classList.toggle('visible');
        });
      });
      document.addEventListener('click', () => {
        document.querySelectorAll('.tip-panel.visible').forEach(p=>p.classList.remove('visible'));
      });
    }
    renderQuestions();

    function scoreQuiz(){
      let total = 0; let answered = 0;
      for(let i=0;i<QUESTIONS.length;i++){
        const chosen = document.querySelector(`input[name="q${i}"]:checked`);
        if(chosen){ total += parseInt(chosen.value, 10); answered++; }
      }
      return { total, answered };
    }

    function mapTier(score){
      if(score <= 18) return { tier:'Basic / Reactive', color:'danger', reco:[
        'Enable MFA company‑wide and enforce a password manager.',
        'Establish a monthly patch cadence and secure configurations.',
        'Set up reliable backups and test restores.'
      ]};
      if(score <= 26) return { tier:'Developing', color:'warn', reco:[
        'Formalize policies and assign control owners.',
        'Add basic monitoring and a tested incident response plan.',
        'Launch quarterly security awareness and phishing tests.'
      ]};
      if(score <= 34) return { tier:'Advanced', color:'success', reco:[
        'Close gaps with tabletop IR exercises and KPIs.',
        'Harden configurations and implement vendor risk reviews.',
        'Automate patching and improve visibility with dashboards.'
      ]};
      return { tier:'Optimized', color:'success', reco:[
        'Pursue continuous improvement and automation.',
        'Expand third‑party assurances (e.g., SOC 2, ISO 27001).',
        'Align metrics to business outcomes and risk appetite.'
      ]};
    }

    // ===== ROI Logic (with Defense industry + slider) =====
    const reductionInput = document.getElementById('reduction');
    const reductionLabel = document.getElementById('reductionLabel');
    reductionInput.addEventListener('input', () => {
      reductionLabel.textContent = `${reductionInput.value}%`;
    });

    function calcROI(){
      const rev = parseFloat(document.getElementById('revenue').value || '0');
      const emp = parseInt(document.getElementById('employees').value || '0', 10);
      const ind = document.getElementById('industry').value;
      const down = parseFloat(document.getElementById('downtime').value || '0');
      const spendPct = parseFloat(document.getElementById('currentSpend').value || '0');
      const reductionPct = parseFloat(reductionInput.value || '35');

      if(!(rev>0 && emp>0 && ind && down>=0 && spendPct>=0)){
        return { ok:false, msg:'Please complete all ROI fields.' };
      }

      const revPerDay = rev / 260; // approx business days

      const mult = {
        retail: 1.1,
        professional: 1.25,
        saas: 1.35,
        finance: 1.7,
        health: 1.8,
        defense: 2.2,
      }[ind] || 1.2;

      // Baseline breach cost model (illustrative)
      const downtimeCost = revPerDay * down;
      const remediationCost = emp * 150 * 16; // 16 hours @ $150 blended
      const overhead = rev * (0.002 * mult);  // 0.2% of revenue scaled by sensitivity
      const estimatedLoss = Math.round(downtimeCost + remediationCost + overhead);

      const selected = Array.from(document.querySelectorAll('#roi-form .ctrl:checked')).map(x=>x.value);
      const ctrlCosts = {
        mfa: 2500,
        edr: Math.max(2500, emp * 6 * 12), // $6/user/mo
        training: Math.max(1500, emp * 2 * 12), // $2/user/mo
        ir: 4000,
        vendor: 3000,
      };
      let invest = 0; selected.forEach(k=> invest += (ctrlCosts[k]||0));

      const totalInvest = invest;
      const avoided = Math.round(estimatedLoss * (reductionPct/100));
      const roi = totalInvest>0 ? (avoided - totalInvest) / totalInvest : 0;

      return { ok:true, rev, emp, ind, down, spendPct, reductionPct, estimatedLoss, totalInvest: Math.round(totalInvest), avoided: Math.round(avoided), roi };
    }

    // ===== Email Sending (EmailJS) =====
    const EMAIL_ENABLED = true; // Option A enabled
    const EMAILJS_PUBLIC_KEY = 'kYNef_lW7qO0tup-6';
    const SERVICE_ID = 'service_dc76qvv';
    const TEMPLATE_ID = 'template_mvy0jqc';

    const OWNER_BCC = 'damian@abiconsulting.llc'; // Include this variable in the template BCC field as {{owner_bcc}}

    function emailConfigured(){
      const ok = EMAIL_ENABLED && EMAILJS_PUBLIC_KEY && !EMAILJS_PUBLIC_KEY.startsWith('YOUR_') && SERVICE_ID && !SERVICE_ID.startsWith('YOUR_') && TEMPLATE_ID && !TEMPLATE_ID.startsWith('YOUR_');
      return ok;
    }

    async function sendEmail(data){
      if(!emailConfigured()){
        return { ok:false, msg:'Email service not configured. Showing results on page instead.' };
      }
      try{
        emailjs.init({ publicKey: EMAILJS_PUBLIC_KEY });
        await emailjs.send(SERVICE_ID, TEMPLATE_ID, data);
        return { ok:true };
      }catch(err){
        return { ok:false, msg: 'Email failed to send. '+ (err?.text || err?.message || '') };
      }
    }

    // ===== Wire up Quiz =====
    document.getElementById('calc-quiz').addEventListener('click', async () => {
      if(document.getElementById('website').value){ return; }

      const { total, answered } = scoreQuiz();
      if(answered < 10){
        show('quiz-result', `<div class="danger">Please answer all questions (${answered}/10)</div>`);
        return;
      }

      const company = document.getElementById('company').value.trim();
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      if(!company || !name || !email){
        show('quiz-result', `<div class="danger">Please complete your contact details.</div>`);
        return;
      }
      if(!isBusinessEmail(email)){
        show('quiz-result', `<div class="danger">Please enter a <strong>business</strong> email (e.g., jane@yourcompany.com).</div>`);
        return;
      }

      const tierInfo = mapTier(total);
      const roi = calcROI(); // include ROI snapshot if available

      const industryMap = {
        retail: "Retail / Low Sensitivity",
        professional: "Professional Services / Moderate",
        saas: "SaaS / Mixed",
        finance: "Finance / High",
        health: "Healthcare / High",
        defense: "Defense / GovCon (CUI/ITAR/DFARS)"
      };

      const summary = {
        // recipient address for the template's {{email}} or {{to_email}}
        email,
        // to_email: email, // use this instead if your template's TO uses {{to_email}}

        owner_bcc: OWNER_BCC, // add {{owner_bcc}} in the template's BCC field

        company, name,
        score: total,
        tier: tierInfo.tier,
        recommendations: tierInfo.reco.join('\n - '),

        roi_estimatedLoss: roi.ok ? roi.estimatedLoss.toLocaleString() : 'N/A',
        roi_investment: roi.ok ? roi.totalInvest.toLocaleString() : 'N/A',
        avoided_loss: roi.ok ? roi.avoided.toLocaleString() : 'N/A',
        roi_ratio: roi.ok ? `${roi.roi.toFixed(2)}x` : 'N/A',
        reductionPct: roi.ok ? String(roi.reductionPct) : '35',
        industry: roi.ok ? (industryMap[roi.ind] || 'N/A') : 'N/A',
      };

      const emailResp = await sendEmail(summary);

      let html = `<div class="badge ${tierInfo.color}">Your Score: ${total} → ${tierInfo.tier}</div>`;
      html += `<div style="margin-top:8px;">Recommended next steps:<ul>` + tierInfo.reco.map(r=>`<li>${r}</li>`).join('') + `</ul></div>`;
      if(roi.ok){
        html += `<div style="margin-top:6px;" class="muted small">ROI snapshot: Est. loss <strong>$${roi.estimatedLoss.toLocaleString()}</strong>, Baseline invest <strong>$${roi.totalInvest.toLocaleString()}</strong>, Avoided loss (at ${roi.reductionPct}%): <strong>$${roi.avoided.toLocaleString()}</strong>, ROI <strong>${roi.roi.toFixed(2)}x</strong></div>`;
      }
      html += `<div class="note" style="margin-top:10px;">`+
              `<strong>Call to Action:</strong> Want a formal roadmap to move from <em>${tierInfo.tier}</em> up a tier? `+
              `Email <a href="mailto:damian@abiconsulting.llc">damian@abiconsulting.llc</a> to schedule a 30‑minute consult.</div>`;

      if(emailResp.ok){
        html = `<div class="success">Your results were emailed to <strong>${email}</strong>.</div>` + html;
      } else {
        html = `<div class="warn">${emailResp.msg}</div>` + html;
      }
      show('quiz-result', html);
    });

    document.getElementById('reset-quiz').addEventListener('click', () => {
      document.getElementById('maturity-form').reset();
      renderQuestions();
      hide('quiz-result');
    });

    // ===== Wire up ROI =====
    document.getElementById('calc-roi').addEventListener('click', () => {
      const res = calcROI();
      if(!res.ok){
        show('roi-result', `<div class="danger">${res.msg}</div>`);
        return;
      }
      const html = `
        <div class=\"badge\">ROI Snapshot</div>
        <div class=\"small\" style=\"margin-top:8px;\">
          Estimated Loss w/ Incident: <strong>$${res.estimatedLoss.toLocaleString()}</strong><br/>
          Baseline Controls Investment: <strong>$${res.totalInvest.toLocaleString()}</strong><br/>
          Avoided Loss (at ${res.reductionPct}%): <strong>$${res.avoided.toLocaleString()}</strong><br/>
          ROI: <strong>${res.roi.toFixed(2)}x</strong>
        </div>
        <div class=\"small muted\" style=\"margin-top:8px;\">
          <strong>What these numbers mean:</strong>
          <ul style=\"margin:6px 0 0 18px;\">
            <li><em>Estimated Loss</em> = downtime cost (revenue/day × downtime) + remediation labor + industry‑scaled overhead.</li>
            <li><em>Baseline Investment</em> = annualized costs for selected controls (MFA, EDR, training, IR plan, vendor risk).</li>
            <li><em>Avoided Loss</em> = the portion of loss those controls are expected to reduce (slider above sets the percentage).</li>
            <li><em>ROI</em> = (Avoided Loss − Investment) ÷ Investment.</li>
          </ul>
        </div>
      `;
      show('roi-result', html);
    });

    document.getElementById('reset-roi').addEventListener('click', () => {
      document.getElementById('roi-form').reset();
      reductionInput.value = 35; reductionLabel.textContent = '35%';
      hide('roi-result');
    });

    // ===== Helpers =====
    function show(id, html){ const el = document.getElementById(id); el.innerHTML = html; el.style.display = 'block'; }
    function hide(id){ const el = document.getElementById(id); el.style.display = 'none'; el.innerHTML = ''; }
  </script>
</body>
</html>
